import{s as e,u as t,j as s}from"./index-Duv89VAf.js";import{r}from"./react-vendor-B4gIioy9.js";import{t as a,a as n}from"./helpers-BubsLHy_.js";import{a as c,P as i}from"./badgeSystem-B5B5Dmxk.js";import{aJ as l,a as o,y as d,aK as m,av as x}from"./icons-DVxOjm_j.js";function u(t){const[s,a]=r.useState([]),[n,c]=r.useState(!0);return r.useEffect((()=>{if(!t)return;!async function(){c(!0);const{data:s}=await e.from("comments").select("*, profiles(username, avatar_url)").eq("post_id",t).order("created_at",{ascending:!0});a(s||[]),c(!1)}();const s=e.channel(`comments:${t}`).on("postgres_changes",{event:"INSERT",schema:"public",table:"comments",filter:`post_id=eq.${t}`},(e=>a((t=>[...t,e.new])))).subscribe();return()=>e.removeChannel(s)}),[t]),{comments:s,loading:n}}const p={async getCircles(){const{data:t,error:s}=await e.from("circles").select("*, circle_members(count)").order("created_at",{ascending:!1});return{data:t,error:s}},async joinCircle(t,s){const{data:r,error:a}=await e.from("circle_members").insert({user_id:t,circle_id:s}).select();return{data:r,error:a}},async leaveCircle(t,s){const{error:r}=await e.from("circle_members").delete().eq("user_id",t).eq("circle_id",s);return{error:r}},async getUserCircles(t){const{data:s,error:r}=await e.from("circle_members").select("circle_id, circles(*)").eq("user_id",t);return{data:s,error:r}},async createPost(t,s,r,a=!1){const{data:n,error:c}=await e.from("posts").insert({user_id:t,circle_id:s,content:r,is_anonymous:a}).select();return{data:n,error:c}},async createComment(t,s,r,a=!1){const{data:n,error:c}=await e.from("comments").insert({user_id:t,post_id:s,content:r,is_anonymous:a}).select();return{data:n,error:c}}};function h({post:e,circleColor:h,onHeart:y,onShare:f}){const{user:g}=t(),[j,b]=r.useState(e.isHearted),[N,v]=r.useState(e.hearts),[_,w]=r.useState(!1),[C,S]=r.useState(""),[k,z]=r.useState(!1),[q,$]=r.useState(!1),{comments:P,loading:R}=u(_?e.id:null),B=e.content.length>200;return s.jsxs("div",{className:"card p-4 mb-3",style:{borderBottomColor:h,borderBottomWidth:"2px"},children:[s.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[s.jsx("div",{className:"w-10 h-10 bg-primary/10 rounded-full flex items-center justify-center text-lg",children:e.author.avatar}),s.jsxs("div",{className:"flex-1",children:[s.jsx("p",{className:"font-semibold text-sm text-text-primary",children:e.author.username}),s.jsxs("p",{className:"text-xs text-text-secondary",children:["Posted ",e.timestamp]})]}),s.jsx("button",{className:"p-1 hover:bg-gray-100 rounded-full",children:s.jsx(l,{size:16,className:"text-text-secondary"})})]}),s.jsxs("div",{className:"mb-3",children:[s.jsx("p",{className:"text-text-primary leading-relaxed",children:B&&!k?a(e.content,200):e.content}),B&&s.jsx("button",{onClick:()=>z(!k),className:"text-primary text-sm mt-1 hover:underline",children:k?"Show less":"Read more"})]}),e.tags&&e.tags.length>0&&s.jsx("div",{className:"flex flex-wrap gap-2 mb-3",children:e.tags.map(((e,t)=>s.jsxs("span",{className:"px-2 py-1 bg-gray-100 text-text-secondary text-xs rounded-full",children:["#",e]},t)))}),s.jsxs("div",{className:"flex items-center gap-4 py-2 border-t border-gray-100",children:[s.jsxs("button",{onClick:()=>{const t=!j;b(t),v((e=>t?e+1:e-1)),y?.(e.id,t),t&&c(i.heartReceived)},className:"flex items-center gap-2 px-3 py-1 rounded-lg transition-all duration-200 "+(j?"text-red-500 bg-red-50":"text-text-secondary hover:text-red-500 hover:bg-red-50"),children:[s.jsx(o,{size:20,className:"transition-transform duration-200 "+(j?"scale-110":""),fill:j?"currentColor":"none"}),s.jsx("span",{className:"text-sm",children:N})]}),s.jsxs("button",{onClick:()=>w(!_),className:"flex items-center gap-2 px-3 py-1 rounded-lg text-text-secondary hover:text-primary hover:bg-primary/10 transition-colors",children:[s.jsx(d,{size:20}),s.jsx("span",{className:"text-sm",children:P.length||e.commentCount||0})]}),s.jsx("button",{onClick:()=>{navigator.clipboard.writeText(`${window.location.origin}/circle/${e.circleId}/post/${e.id}`),f?.()},className:"flex items-center gap-2 px-3 py-1 rounded-lg text-text-secondary hover:text-primary hover:bg-primary/10 transition-colors",children:s.jsx(m,{size:20})})]}),_&&s.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-100",children:[R?s.jsx("div",{className:"text-center py-4",children:s.jsx("div",{className:"inline-block animate-spin rounded-full h-6 w-6 border-b-2 border-primary"})}):P.length>0?s.jsxs("div",{className:"space-y-3 mb-4",children:[P.slice(0,5).map((e=>s.jsxs("div",{className:"flex gap-3",children:[s.jsx("div",{className:"w-8 h-8 bg-primary/10 rounded-full flex items-center justify-center text-sm flex-shrink-0",children:e.author.avatar}),s.jsxs("div",{className:"flex-1",children:[s.jsxs("div",{className:"bg-gray-50 rounded-xl p-3",children:[s.jsx("p",{className:"font-medium text-sm text-text-primary mb-1",children:e.profiles?.username||"Anonymous"}),s.jsx("p",{className:"text-sm text-text-primary",children:e.content})]}),s.jsxs("div",{className:"flex items-center gap-4 mt-1 ml-3",children:[s.jsx("span",{className:"text-xs text-text-secondary",children:n(e.created_at)}),s.jsx("button",{className:"text-xs text-text-secondary hover:text-primary",children:"Reply"}),s.jsxs("button",{className:"flex items-center gap-1 text-xs text-text-secondary hover:text-red-500",children:[s.jsx(o,{size:12}),e.hearts]})]})]})]},e.id))),P.length>5&&s.jsx("button",{className:"text-sm text-primary hover:underline",children:"Load more comments"})]}):s.jsx("p",{className:"text-text-secondary text-sm mb-4",children:"No comments yet. Be the first!"}),s.jsxs("div",{className:"flex gap-3",children:[s.jsx("div",{className:"w-8 h-8 bg-primary/10 rounded-full flex items-center justify-center text-sm flex-shrink-0",children:"ðŸ»"}),s.jsxs("div",{className:"flex-1 flex gap-2",children:[s.jsx("input",{type:"text",value:C,onChange:e=>S(e.target.value),placeholder:"Add a comment...",className:"flex-1 px-3 py-2 border border-gray-200 rounded-xl focus:border-primary outline-none text-sm",maxLength:300}),s.jsx("button",{onClick:async()=>{if(C.trim()&&g&&!q){$(!0);try{await p.createComment(g.id,e.id,C.trim(),!1),S("")}catch(t){}finally{$(!1)}}},disabled:!C.trim()||q,className:"p-2 rounded-xl transition-colors "+(C.trim()&&!q?"bg-primary text-white hover:bg-primary/90":"bg-gray-200 text-gray-400 cursor-not-allowed"),children:s.jsx(x,{size:16,className:q?"animate-pulse":""})})]})]})]})]})}export{h as P,p as c};
